
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Watt-Turnier Viertelfinale</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    table, th, td { border: 1px solid #000; }
    th, td { padding: 8px; text-align: center; }
    th { background-color: #3656A7; color: white; }
    .navigation-button, .draw-button, .reset-button, .save-button {
      margin: 10px 5px; padding: 8px 12px; background-color: #3656A7; color: white; border: none; cursor: pointer;
    }
    .navigation-button:hover, .draw-button:hover, .reset-button:hover, .save-button:hover { background-color: #2a4485; }
    select { width: 100%; }
  </style>
</head>
<body>
  <h1>Viertelfinale</h1>

  <a href="vorrunde.html"><button class="navigation-button">Zur Vorrunde</button></a>
  <button class="draw-button" onclick="drawPairs()">Paarungen auslosen</button>
  <button class="reset-button" onclick="resetPairs()">Paarungen zur√ºcksetzen</button>
  <button class="save-button" onclick="saveWinners()">Sieger speichern</button>
  <a href="halbfinale.html"><button class="navigation-button">Zum Halbfinale</button></a>

  <table id="quarterfinal">
    <thead>
      <tr><th>Platz</th><th>Mannschaft</th><th>Gesamtpunkte</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Paarungen</h2>
  <table id="pairs">
    <thead>
      <tr><th>Match</th><th>Team A</th><th>Team B</th><th>Sieger</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
let top8 = [];

function loadQuarterfinalTeams() {
  const teams = JSON.parse(localStorage.getItem('wattTeams')) || [];
  teams.forEach(team => {
    const totalPoints = team.rounds.reduce((sum, r) => sum + (r.points || 0), 0);
    const totalGoals = team.rounds.reduce((sum, r) => sum + (r.goals || 0), 0);
    team.totalScore = totalPoints * 100 + totalGoals;
  });
  teams.sort((a, b) => b.totalScore - a.totalScore);
  top8 = teams.slice(0, 8);

  const tbody = document.querySelector('#quarterfinal tbody');
  tbody.innerHTML = '';
  top8.forEach((team, index) => {
    const row = tbody.insertRow();
    row.insertCell(0).textContent = index + 1;
    row.insertCell(1).textContent = `${team.player1} / ${team.player2}`;
    row.insertCell(2).textContent = team.totalScore;
  });

  loadPairsFromStorage();
}

function drawPairs() {
  if (top8.length < 8) { alert('Nicht gen√ºgend Teams!'); return; }
  const shuffled = [...top8];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  const pairs = [];
  for (let i = 0; i < shuffled.length; i += 2) {
    pairs.push({ match: `Spiel ${i/2+1}`, teamA: `${shuffled[i].player1} / ${shuffled[i].player2}`, teamB: `${shuffled[i+1].player1} / ${shuffled[i+1].player2}`, winner: "" });
  }
  localStorage.setItem('quarterfinalPairs', JSON.stringify(pairs));
  displayPairs(pairs);
}

function loadPairsFromStorage() {
  const savedPairs = JSON.parse(localStorage.getItem('quarterfinalPairs')) || [];
  if (savedPairs.length > 0) displayPairs(savedPairs);
}

function displayPairs(pairs) {
  const tbody = document.querySelector('#pairs tbody');
  tbody.innerHTML = '';
  pairs.forEach(pair => {
    const row = tbody.insertRow();
    row.insertCell(0).textContent = pair.match;
    row.insertCell(1).textContent = pair.teamA;
    row.insertCell(2).textContent = pair.teamB;
    const selectCell = row.insertCell(3);
    const select = document.createElement('select');
    select.className = 'winner-select';
    select.dataset.match = pair.match;
    select.innerHTML = `<option value="">Sieger w√§hlen</option><option value="Team A">Team A</option><option value="Team B">Team B</option>`;
    if (pair.winner) select.value = (pair.winner === pair.teamA) ? 'Team A' : 'Team B';
    selectCell.appendChild(select);
  });
}

function saveWinners() {
  const pairs = JSON.parse(localStorage.getItem('quarterfinalPairs')) || [];
  document.querySelectorAll('.winner-select').forEach(select => {
    const match = select.dataset.match;
    const choice = select.value;
    const pair = pairs.find(p => p.match === match);
    if (choice === 'Team A') pair.winner = pair.teamA;
    else if (choice === 'Team B') pair.winner = pair.teamB;
    else pair.winner = "";
  });
  localStorage.setItem('quarterfinalPairs', JSON.stringify(pairs));
  const winners = pairs.filter(p => p.winner).map(p => p.winner);
  if (winners.length === 4) {
    localStorage.setItem('semifinalTeams', JSON.stringify(winners));
    alert('Sieger gespeichert! Halbfinale ist bereit.');
  } else alert('Bitte alle Sieger ausw√§hlen!');
}

function resetPairs() {
  localStorage.removeItem('quarterfinalPairs');
  localStorage.removeItem('semifinalTeams');
  document.querySelector('#pairs tbody').innerHTML = '';
  alert('Paarungen zur√ºckgesetzt.');
}

document.addEventListener('DOMContentLoaded', loadQuarterfinalTeams);
</script>

<!-- Service Worker Registrierung -->
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/watt-turnier-app/service-worker.js")
    .catch(err => console.log("SW registration failed", err));
}
</script>

<!-- Versionsanzeige -->
<div id="app-version" 
     style="
       position:fixed;
       bottom:40px;
       right:10px;
       background:#eee;
       padding:5px 10px;
       border-radius:5px;
       font-size:12px;
       color:#333;
       z-index:999999;
     ">
  Version ‚Ä¶
</div>

<!-- Update-Banner -->
<div id="update-banner" 
     style="
       display:none;
       position:fixed;
       bottom:80px;
       left:0;
       right:0;
       background:#3656A7;
       color:white;
       padding:15px;
       text-align:center;
       font-size:16px;
       z-index:999999;
     ">
  Neue Version verf√ºgbar ‚Äì tippe hier zum Aktualisieren
</div>

<script>
// Automatische Versionsanzeige
async function getAppVersion() {
  const versionBox = document.getElementById("app-version");
  if (!navigator.serviceWorker.controller) {
    versionBox.textContent = "Version l√§dt‚Ä¶";
    return;
  }

  const registration = await navigator.serviceWorker.getRegistration();
  if (!registration || !registration.active) return;

  registration.active.postMessage({ type: "GET_VERSION" });

  navigator.serviceWorker.addEventListener("message", event => {
    if (event.data.type === "VERSION") {
      versionBox.textContent = "Version " + event.data.version;
    }
  });
}

getAppVersion();

// Update-Banner anzeigen, wenn neuer SW aktiv wird
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.addEventListener("controllerchange", () => {
    const banner = document.getElementById("update-banner");
    if (banner) banner.style.display = "block";
  });
}

// Klick auf Banner ‚Üí Seite neu laden
document.getElementById("update-banner").addEventListener("click", () => {
  location.reload();
});
</script>

<!-- ‚úÖ Men√ºleiste -->
<nav class="app-menu">
  <a href="index.html">üè†<br>Anmeldung</a>
  <a href="vorrunde.html">üìã<br>Vorrunde</a>
  <a href="auslosung1.html">üé≤<br>Auslosung 1</a>
  <a href="auslosung2.html">üé≤<br>Auslosung 2</a>
  <a href="auslosung3.html">üé≤<br>Auslosung 3</a>
  <a href="auslosung4.html">üé≤<br>Auslosung 4</a>
  <a href="auslosung5.html">üé≤<br>Auslosung 5</a>
  <a href="viertelfinale.html">üèÜ<br>Viertelfinale</a>
  <a href="halbfinale.html">ü•à<br>Halbfinale</a>
  <a href="finale.html">ü•á<br>Finale</a>
</nav>

<style>
/* Men√ºleiste exakt wie in index.html */
.app-menu {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #3656A7;
  display: flex;
  justify-content: space-around;
  padding: 10px 0;
  border-top: 2px solid #2a4485;
  z-index: 1000;
}

.app-menu a {
  color: white;
  text-decoration: none;
  font-size: 14px;
  text-align: center;
  flex: 1;
}

.app-menu a:hover {
  background-color: #2a4485;
  padding: 8px;
  border-radius: 4px;
}
</style>

</body>
</html>




