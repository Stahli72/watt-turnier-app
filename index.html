<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Watt-Turnier Anmeldung</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
</head>

<body>
  <h1>Watt-Turnier Anmeldung</h1>

  <section>
    <h2>Turnierdetails</h2>
    <p><strong>Datum:</strong> 10.01.2026</p>
    <p><strong>Ort:</strong> Albert-Kaindl-Sportheim</p>
    <p><strong>Startgeld:</strong> 10€ pro Teilnehmer</p>
  </section>

  <section>
    <h2>Neues Team hinzufügen</h2>
    <form id="team-form">
      <label for="spieler1">Spieler 1</label>
      <input type="text" id="spieler1" name="spieler1" required>

      <label for="spieler2">Spieler 2</label>
      <input type="text" id="spieler2" name="spieler2" required>

      <button type="submit">➕ Team hinzufügen</button>
    </form>
  </section>

  <section>
    <button id="reset-button">⚠ Alle Teams & Turnierdaten löschen</button>
  </section>

  <section>
    <h2>Angemeldete Teams</h2>
    <ul id="team-list">
      <li>1 Franz Hans</li>
    </ul>
  </section>

  <!-- Update-Banner -->
  <div id="update-banner" 
       style="
         display:none;
         position:fixed;
         bottom:80px;
         left:0;
         right:0;
         background:#3656A7;
         color:white;
         padding:15px;
         text-align:center;
         font-size:16px;
         z-index:999999;
       ">
    Neue Version verfügbar – tippe hier zum Aktualisieren
  </div>

  <!-- Versionsanzeige -->
  <div id="app-version" 
       style="
         position:fixed;
         bottom:40px;
         right:10px;
         background:#eee;
         padding:5px 10px;
         border-radius:5px;
         font-size:12px;
         color:#333;
         z-index:999999;
       ">
    Version lädt…
  </div>

  <script src="script.js"></script>

  <!-- Service Worker Registrierung -->
  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .catch(err => console.error("Service Worker Fehler:", err));
  }
  </script>

  <!-- Version abfragen -->
  <script>
  async function waitForServiceWorker() {
    if (!navigator.serviceWorker.controller) {
      return new Promise(resolve => {
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          resolve();
        });
      });
    }
  }

  async function getAppVersion() {
    const versionBox = document.getElementById("app-version");
    versionBox.textContent = "Version lädt…";

    await waitForServiceWorker();

    const registration = await navigator.serviceWorker.getRegistration();
    if (!registration || !registration.active) {
      versionBox.textContent = "Keine Version verfügbar";
      return;
    }

    registration.active.postMessage({ type: "GET_VERSION" });

    navigator.serviceWorker.addEventListener("message", event => {
      if (event.data.type === "VERSION") {
        versionBox.textContent = "Version " + event.data.version;
      }
    });
  }

  getAppVersion();

  // Update-Banner anzeigen, wenn neuer SW aktiv wird
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.addEventListener("controllerchange", () => {
      const banner = document.getElementById("update-banner");
      if (banner) banner.style.display = "block";
    });
  }

  // Klick auf Banner → Seite neu laden
  document.getElementById("update-banner").addEventListener("click", () => {
    location.reload();
  });
  </script>
</body>
</html>
