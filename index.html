<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Watt-Turnier Anmeldung</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
</head>

<body>

  <h1>Watt-Turnier Anmeldung</h1>

  <div class="container">
    <label for="teamname">Teamname:</label>
    <input type="text" id="teamname" placeholder="Teamname eingeben">

    <label for="spieler1">Spieler 1:</label>
    <input type="text" id="spieler1" placeholder="Name Spieler 1">

    <label for="spieler2">Spieler 2:</label>
    <input type="text" id="spieler2" placeholder="Name Spieler 2">

    <button onclick="anmelden()">Anmelden</button>
  </div>

  <div class="menu">
    <a href="vorrunde.html">Vorrunde</a>
    <a href="auslosung1.html">Auslosung 1</a>
    <a href="auslosung2.html">Auslosung 2</a>
    <a href="auslosung3.html">Auslosung 3</a>
    <a href="auslosung4.html">Auslosung 4</a>
    <a href="auslosung5.html">Auslosung 5</a>
    <a href="viertelfinale.html">Viertelfinale</a>
    <a href="halbfinale.html">Halbfinale</a>
    <a href="finale.html">Finale</a>
  </div>

  <!-- Update-Banner -->
  <div id="update-banner" 
       style="
         display:none;
         position:fixed;
         bottom:80px;
         left:0;
         right:0;
         background:#3656A7;
         color:white;
         padding:15px;
         text-align:center;
         font-size:16px;
         z-index:999999;
       ">
    Neue Version verfügbar – tippe hier zum Aktualisieren
  </div>

  <!-- Versionsanzeige -->
  <div id="app-version" 
       style="
         position:fixed;
         bottom:40px;
         right:10px;
         background:#eee;
         padding:5px 10px;
         border-radius:5px;
         font-size:12px;
         color:#333;
         z-index:999999;
       ">
    Version lädt…
  </div>

  <script src="script.js"></script>

  <script>
  // Warten, bis der Service Worker wirklich aktiv ist
  async function waitForServiceWorker() {
    if (!navigator.serviceWorker.controller) {
      return new Promise(resolve => {
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          resolve();
        });
      });
    }
  }

  // Version vom Service Worker abfragen
  async function getAppVersion() {
    const versionBox = document.getElementById("app-version");
    versionBox.textContent = "Version lädt…";

    await waitForServiceWorker();

    const registration = await navigator.serviceWorker.getRegistration();
    if (!registration || !registration.active) {
      versionBox.textContent = "Keine Version verfügbar";
      return;
    }

    registration.active.postMessage({ type: "GET_VERSION" });

    navigator.serviceWorker.addEventListener("message", event => {
      if (event.data.type === "VERSION") {
        versionBox.textContent = "Version " + event.data.version;
      }
    });
  }

  getAppVersion();

  // Update-Banner anzeigen, wenn neuer SW aktiv wird
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.addEventListener("controllerchange", () => {
      const banner = document.getElementById("update-banner");
      if (banner) banner.style.display = "block";
    });
  }

  // Klick auf Banner → Seite neu laden
  document.getElementById("update-banner").addEventListener("click", () => {
    location.reload();
  });
  </script>

</body>
</html>

