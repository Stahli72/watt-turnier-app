
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watt-Turnier Halbfinale</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
table, th, td { border: 1px solid #000; }
th, td { padding: 8px; text-align: center; }
th { background-color: #3656A7; color: white; }
button { margin: 10px 5px; padding: 8px 12px; background-color: #3656A7; color: white; border: none; cursor: pointer; }
button:hover { background-color: #2a4485; }
select { width: 100%; }
</style>
</head>
<body>
<h1>Halbfinale</h1>

<a href="viertelfinale.html"><button>ZurÃ¼ck zum Viertelfinale</button></a>
<button onclick="saveFinalists()">Sieger speichern</button>
<a href="finale.html"><button>Zur Finalseite</button></a>

<table id="semifinal">
<thead><tr><th>Match</th><th>Team A</th><th>Team B</th><th>Sieger</th></tr></thead>
<tbody></tbody>
</table>

<script>
function loadSemifinalTeams() {
  let pairs = JSON.parse(localStorage.getItem('semifinalPairs')) || [];

  if (pairs.length === 0) {
    const teams = JSON.parse(localStorage.getItem('semifinalTeams')) || [];
    if (teams.length !== 4) {
      alert('Keine Halbfinal-Teams gefunden! Bitte zuerst Viertelfinale abschlieÃŸen.');
      return;
    }
    pairs = [
      { match: 'Halbfinale 1', teamA: teams[0], teamB: teams[3], winner: "" },
      { match: 'Halbfinale 2', teamA: teams[1], teamB: teams[2], winner: "" }
    ];
    localStorage.setItem('semifinalPairs', JSON.stringify(pairs));
  }

  displayPairs(pairs);
}

function displayPairs(pairs) {
  const tbody = document.querySelector('#semifinal tbody');
  tbody.innerHTML = '';
  pairs.forEach(pair => {
    const row = tbody.insertRow();
    row.insertCell(0).textContent = pair.match;
    row.insertCell(1).textContent = pair.teamA;
    row.insertCell(2).textContent = pair.teamB;

    const selectCell = row.insertCell(3);
    const select = document.createElement('select');
    select.className = 'winner-select';
    select.dataset.match = pair.match;
    select.innerHTML = `<option value="">Sieger wÃ¤hlen</option>
                        <option value="Team A">Team A</option>
                        <option value="Team B">Team B</option>`;
    if (pair.winner) {
      select.value = (pair.winner === pair.teamA) ? 'Team A' : 'Team B';
    }
    selectCell.appendChild(select);
  });
}

function saveFinalists() {
  const pairs = JSON.parse(localStorage.getItem('semifinalPairs')) || [];
  document.querySelectorAll('.winner-select').forEach(select => {
    const match = select.dataset.match;
    const choice = select.value;
    const pair = pairs.find(p => p.match === match);
    if (choice === 'Team A') pair.winner = pair.teamA;
    else if (choice === 'Team B') pair.winner = pair.teamB;
  });

  localStorage.setItem('semifinalPairs', JSON.stringify(pairs));

  const finalists = pairs.filter(p => p.winner).map(p => p.winner);
  const losers = pairs.map(p => (p.winner === p.teamA ? p.teamB : p.teamA));

  if (finalists.length === 2) {
    localStorage.setItem('finalTeams', JSON.stringify(finalists));
    localStorage.setItem('thirdPlaceTeams', JSON.stringify(losers));
    alert('Finalisten und Teams fÃ¼r Platz 3 gespeichert! Finale ist bereit.');
  } else {
    alert('Bitte beide Sieger auswÃ¤hlen!');
  }
}

document.addEventListener('DOMContentLoaded', loadSemifinalTeams);
</script>

<!-- Service Worker Registrierung -->
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/watt-turnier-app/service-worker.js")
    .catch(err => console.log("SW registration failed", err));
}
</script>

<!-- Versionsanzeige -->
<div id="app-version" 
     style="
       position:fixed;
       bottom:40px;
       right:10px;
       background:#eee;
       padding:5px 10px;
       border-radius:5px;
       font-size:12px;
       color:#333;
       z-index:999999;
     ">
  Version â€¦
</div>

<!-- Update-Banner -->
<div id="update-banner" 
     style="
       display:none;
       position:fixed;
       bottom:80px;
       left:0;
       right:0;
       background:#3656A7;
       color:white;
       padding:15px;
       text-align:center;
       font-size:16px;
       z-index:999999;
     ">
  Neue Version verfÃ¼gbar â€“ tippe hier zum Aktualisieren
</div>

<script>
// Automatische Versionsanzeige
async function getAppVersion() {
  const versionBox = document.getElementById("app-version");
  if (!navigator.serviceWorker.controller) {
    versionBox.textContent = "Version lÃ¤dtâ€¦";
    return;
  }

  const registration = await navigator.serviceWorker.getRegistration();
  if (!registration || !registration.active) return;

  registration.active.postMessage({ type: "GET_VERSION" });

  navigator.serviceWorker.addEventListener("message", event => {
    if (event.data.type === "VERSION") {
      versionBox.textContent = "Version " + event.data.version;
    }
  });
}

getAppVersion();

// Update-Banner anzeigen, wenn neuer SW aktiv wird
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.addEventListener("controllerchange", () => {
    const banner = document.getElementById("update-banner");
    if (banner) banner.style.display = "block";
  });
}

// Klick auf Banner â†’ Seite neu laden
document.getElementById("update-banner").addEventListener("click", () => {
  location.reload();
});
</script>

<!-- âœ… MenÃ¼leiste -->
<nav class="app-menu">
  <a href="index.html">ğŸ <br>Anmeldung</a>
  <a href="vorrunde.html">ğŸ“‹<br>Vorrunde</a>
  <a href="auslosung1.html">ğŸ²<br>Auslosung 1</a>
  <a href="auslosung2.html">ğŸ²<br>Auslosung 2</a>
  <a href="auslosung3.html">ğŸ²<br>Auslosung 3</a>
  <a href="auslosung4.html">ğŸ²<br>Auslosung 4</a>
  <a href="auslosung5.html">ğŸ²<br>Auslosung 5</a>
  <a href="viertelfinale.html">ğŸ†<br>Viertelfinale</a>
  <a href="halbfinale.html">ğŸ¥ˆ<br>Halbfinale</a>
  <a href="finale.html">ğŸ¥‡<br>Finale</a>
</nav>

<style>
/* MenÃ¼leiste exakt wie in index.html */
.app-menu {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #3656A7;
  display: flex;
  justify-content: space-around;
  padding: 10px 0;
  border-top: 2px solid #2a4485;
  z-index: 1000;
}

.app-menu a {
  color: white;
  text-decoration: none;
  font-size: 14px;
  text-align: center;
  flex: 1;
}

.app-menu a:hover {
  background-color: #2a4485;
  padding: 8px;
  border-radius: 4px;
}
</style>
  
</body>
</html>



