
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watt-Turnier Finale & Platz 3</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
table, th, td { border: 1px solid #000; }
th, td { padding: 8px; text-align: center; }
th { background-color: #3656A7; color: white; }
button { margin: 10px 5px; padding: 8px 12px; background-color: #3656A7; color: white; border: none; cursor: pointer; }
button:hover { background-color: #2a4485; }
select { width: 100%; }
h2 { margin-top: 30px; }
.gold { background-color: #FFD700; }   /* Gold */
.silver { background-color: #C0C0C0; } /* Silber */
.bronze { background-color: #CD7F32; } /* Bronze */
</style>
</head>
<body>
<h1>Finale & Spiel um Platz 3</h1>

<!-- Navigation -->
<a href="halbfinale.html"><button>Zur√ºck zum Halbfinale</button></a>
<button onclick="saveResults()">Sieger speichern</button>

<!-- Finale -->
<h2>Finale</h2>
<table id="final">
<colgroup>
  <col style="width:20%">
  <col style="width:30%">
  <col style="width:30%">
  <col style="width:20%">
</colgroup>
<thead><tr><th>Match</th><th>Team A</th><th>Team B</th><th>Sieger</th></tr></thead>
<tbody></tbody>
</table>

<!-- Platz 3 -->
<h2>Spiel um Platz 3</h2>
<table id="thirdPlace">
<colgroup>
  <col style="width:20%">
  <col style="width:30%">
  <col style="width:30%">
  <col style="width:20%">
</colgroup>
<thead><tr><th>Match</th><th>Team A</th><th>Team B</th><th>Sieger</th></tr></thead>
<tbody></tbody>
</table>

<!-- Rangliste -->
<h2>Endergebnis</h2>
<table id="ranking" style="display:none;">
<colgroup>
  <col style="width:20%">
  <col style="width:80%">
</colgroup>
<thead><tr><th>Platz</th><th>Mannschaft</th></tr></thead>
<tbody></tbody>
</table>

<script>
function loadMatches() {
  const finalTeams = JSON.parse(localStorage.getItem('finalTeams')) || [];
  const thirdPlaceTeams = JSON.parse(localStorage.getItem('thirdPlaceTeams')) || [];

  if (finalTeams.length !== 2 || thirdPlaceTeams.length !== 2) {
    alert('Keine Daten gefunden! Bitte zuerst Halbfinale abschlie√üen.');
    return;
  }

  // Finale anzeigen
  const finalRow = document.querySelector('#final tbody');
  finalRow.innerHTML = '';
  const rowF = finalRow.insertRow();
  rowF.insertCell(0).textContent = 'Finale';
  rowF.insertCell(1).textContent = finalTeams[0];
  rowF.insertCell(2).textContent = finalTeams[1];
  const selectF = document.createElement('select');
  selectF.className = 'winner-select';
  selectF.dataset.match = 'Finale';
  selectF.innerHTML = `<option value="">Sieger w√§hlen</option>
                       <option value="Team A">Team A</option>
                       <option value="Team B">Team B</option>`;
  rowF.insertCell(3).appendChild(selectF);

  // Spiel um Platz 3 anzeigen
  const thirdRow = document.querySelector('#thirdPlace tbody');
  thirdRow.innerHTML = '';
  const rowT = thirdRow.insertRow();
  rowT.insertCell(0).textContent = 'Platz 3';
  rowT.insertCell(1).textContent = thirdPlaceTeams[0];
  rowT.insertCell(2).textContent = thirdPlaceTeams[1];
  const selectT = document.createElement('select');
  selectT.className = 'winner-select';
  selectT.dataset.match = 'Platz 3';
  selectT.innerHTML = `<option value="">Sieger w√§hlen</option>
                       <option value="Team A">Team A</option>
                       <option value="Team B">Team B</option>`;
  rowT.insertCell(3).appendChild(selectT);

  // Falls bereits gespeicherte Sieger existieren, Auswahl setzen
  const savedWinner = localStorage.getItem('tournamentWinner');
  const savedRunnerUp = localStorage.getItem('runnerUp');
  const savedThird = localStorage.getItem('thirdPlaceWinner');
  const savedFourth = localStorage.getItem('fourthPlace');

  if (savedWinner && savedRunnerUp && savedThird && savedFourth) {
    // Auswahl f√ºr Finale
    selectF.value = (savedWinner === finalTeams[0]) ? 'Team A' : 'Team B';
    // Auswahl f√ºr Platz 3
    selectT.value = (savedThird === thirdPlaceTeams[0]) ? 'Team A' : 'Team B';
    // Rangliste anzeigen
    displayRanking([savedWinner, savedRunnerUp, savedThird, savedFourth]);
  }
}

function saveResults() {
  const finalTeams = JSON.parse(localStorage.getItem('finalTeams')) || [];
  const thirdTeams = JSON.parse(localStorage.getItem('thirdPlaceTeams')) || [];
  let tournamentWinner = '';
  let runnerUp = '';
  let thirdPlaceWinner = '';
  let fourthPlace = '';

  document.querySelectorAll('.winner-select').forEach(select => {
    const match = select.dataset.match;
    const choice = select.value;
    if (match === 'Finale') {
      tournamentWinner = (choice === 'Team A') ? finalTeams[0] : (choice === 'Team B') ? finalTeams[1] : '';
      runnerUp = (choice === 'Team A') ? finalTeams[1] : (choice === 'Team B') ? finalTeams[0] : '';
    } else if (match === 'Platz 3') {
      thirdPlaceWinner = (choice === 'Team A') ? thirdTeams[0] : (choice === 'Team B') ? thirdTeams[1] : '';
      fourthPlace = (choice === 'Team A') ? thirdTeams[1] : (choice === 'Team B') ? thirdTeams[0] : '';
    }
  });

  if (tournamentWinner && runnerUp && thirdPlaceWinner && fourthPlace) {
    // Ergebnisse speichern
    localStorage.setItem('tournamentWinner', tournamentWinner);
    localStorage.setItem('runnerUp', runnerUp);
    localStorage.setItem('thirdPlaceWinner', thirdPlaceWinner);
    localStorage.setItem('fourthPlace', fourthPlace);

    // Rangliste anzeigen
    displayRanking([tournamentWinner, runnerUp, thirdPlaceWinner, fourthPlace]);
  } else {
    alert('Bitte beide Sieger ausw√§hlen!');
  }
}

function displayRanking(teams) {
  const rankingTable = document.querySelector('#ranking');
  rankingTable.style.display = 'table';
  const tbody = rankingTable.querySelector('tbody');
  tbody.innerHTML = '';

  teams.forEach((team, index) => {
    const row = tbody.insertRow();
    row.insertCell(0).textContent = `${index + 1}. Platz`;
    row.insertCell(1).textContent = team;

    // Farben f√ºr Platzierungen
    if (index === 0) row.classList.add('gold');
    else if (index === 1) row.classList.add('silver');
    else if (index === 2) row.classList.add('bronze');
  });
}

document.addEventListener('DOMContentLoaded', loadMatches);
</script>

<!-- Service Worker Registrierung -->
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/watt-turnier-app/service-worker.js")
    .catch(err => console.log("SW registration failed", err));
}
</script>

<!-- Versionsanzeige -->
<div id="app-version" 
     style="
       position:fixed;
       bottom:40px;
       right:10px;
       background:#eee;
       padding:5px 10px;
       border-radius:5px;
       font-size:12px;
       color:#333;
       z-index:999999;
     ">
  Version ‚Ä¶
</div>

<!-- Update-Banner -->
<div id="update-banner" 
     style="
       display:none;
       position:fixed;
       bottom:80px;
       left:0;
       right:0;
       background:#3656A7;
       color:white;
       padding:15px;
       text-align:center;
       font-size:16px;
       z-index:999999;
     ">
  Neue Version verf√ºgbar ‚Äì tippe hier zum Aktualisieren
</div>

<script>
// Automatische Versionsanzeige
async function getAppVersion() {
  const versionBox = document.getElementById("app-version");
  if (!navigator.serviceWorker.controller) {
    versionBox.textContent = "Version l√§dt‚Ä¶";
    return;
  }

  const registration = await navigator.serviceWorker.getRegistration();
  if (!registration || !registration.active) return;

  registration.active.postMessage({ type: "GET_VERSION" });

  navigator.serviceWorker.addEventListener("message", event => {
    if (event.data.type === "VERSION") {
      versionBox.textContent = "Version " + event.data.version;
    }
  });
}

getAppVersion();

// Update-Banner anzeigen, wenn neuer SW aktiv wird
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.addEventListener("controllerchange", () => {
    const banner = document.getElementById("update-banner");
    if (banner) banner.style.display = "block";
  });
}

// Klick auf Banner ‚Üí Seite neu laden
document.getElementById("update-banner").addEventListener("click", () => {
  location.reload();
});
</script>

<!-- ‚úÖ Men√ºleiste -->
<nav class="app-menu">
  <a href="index.html">üè†<br>Anmeldung</a>
  <a href="vorrunde.html">üìã<br>Vorrunde</a>
  <a href="auslosung1.html">üé≤<br>Auslosung 1</a>
  <a href="auslosung2.html">üé≤<br>Auslosung 2</a>
  <a href="auslosung3.html">üé≤<br>Auslosung 3</a>
  <a href="auslosung4.html">üé≤<br>Auslosung 4</a>
  <a href="auslosung5.html">üé≤<br>Auslosung 5</a>
  <a href="viertelfinale.html">üèÜ<br>Viertelfinale</a>
  <a href="halbfinale.html">ü•à<br>Halbfinale</a>
  <a href="finale.html">ü•á<br>Finale</a>
</nav>

<style>
/* Men√ºleiste exakt wie in index.html */
.app-menu {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #3656A7;
  display: flex;
  justify-content: space-around;
  padding: 10px 0;
  border-top: 2px solid #2a4485;
  z-index: 1000;
}

.app-menu a {
  color: white;
  text-decoration: none;
  font-size: 14px;
  text-align: center;
  flex: 1;
}

.app-menu a:hover {
  background-color: #2a4485;
  padding: 8px;
  border-radius: 4px;
}
</style>
  
</body>
</html>



