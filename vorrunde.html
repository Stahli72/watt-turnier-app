
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watt-Turnier Vorrunde</title>
    <style>
    .app-menu {
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: #fff;
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
        border-top: 1px solid #ccc;
        z-index: 1000;
    }
    .app-menu a {
        text-align: center;
        font-size: 14px;
        text-decoration: none;
        color: black;
    }
</style>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
    }
    table, th, td {
        border: 1px solid #000;
    }
    th, td {
        padding: 6px;
        text-align: center;
        font-size: 14px;
    }
    th {
        background-color: #3656A7;
        color: white;
        position: sticky;
        top: 0;
        z-index: 2;
    }
    input {
        width: 100%;
        box-sizing: border-box;
        text-align: center;
    }
    .sort-button, .navigation-button, .export-button {
        margin: 10px 5px;
        padding: 8px 12px;
        background-color: #3656A7;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
    }
    .sort-button:hover, .navigation-button:hover, .export-button:hover {
        background-color: #2a4485;
    }
    #searchTeam {
        margin: 10px 0;
        padding: 8px;
        width: 250px;
        font-size: 16px;
    }
    /* ‚úÖ Fett f√ºr Gesamt Total */
    .overall-total {
        font-weight: bold;
    }
    /* ‚úÖ Dickere Rahmen f√ºr Runden-Spalten */
    .round-border {
        border-left: 3px solid #000;
        border-right: 3px solid #000;
    }
    /* ‚úÖ Hintergrundfarben f√ºr jede Runde */
    .round1 { background-color: #E6F7FF; } /* Hellblau */
    .round2 { background-color: #FFF2CC; } /* Hellgelb */
    .round3 { background-color: #E2F0D9; } /* Hellgr√ºn */
    .round4 { background-color: #FCE4D6; } /* Hellorange */
    .round5 { background-color: #F4CCCC; } /* Hellrot */
    @media (max-width: 768px) {
        table {
            font-size: 12px;
        }
        #searchTeam {
            width: 100%;
        }
    }
</style>
</head>
<body>
<h1>Vorrunde Tabelle</h1>

<input type="text" id="searchTeam" placeholder="Mannschaft suchen..." oninput="filterTeams()">

<!-- Navigation -->
<a href="Anmeldung.html"><button class="navigation-button">Zur Anmeldung</button></a>
<button class="sort-button" onclick="sortTeams()">Sortieren jetzt</button>
<a href="auslosung1_10.06.html"><button class="navigation-button">Zur Auslosung 1</button></a>
<a href="auslosung2_10.06.html"><button class="navigation-button">Zur Auslosung 2</button></a>
<a href="auslosung3_10.06.html"><button class="navigation-button">Zur Auslosung 3</button></a>
<a href="auslosung4_10.06.html"><button class="navigation-button">Zur Auslosung 4</button></a>
<a href="auslosung5_10.06.html"><button class="navigation-button">Zur Auslosung 5</button></a>
<a href="viertelfinale.html"><button class="navigation-button">Zum Viertelfinale</button></a>
<button class="export-button" onclick="exportToExcel()">üì§ Export als XLSX</button>

<!-- Tabelle -->
<table id="preliminary-round">
    <colgroup>
        <col style="width:5%">      <!-- Platz -->
        <col style="width:15%">     <!-- Mannschaft -->
        <col class="round-border" style="width:4%" span="2"> <!-- Ru 1 -->
        <col class="round-border" style="width:4%" span="2"> <!-- Ru 2 -->
        <col class="round-border" style="width:4%" span="2"> <!-- Ru 3 -->
        <col class="round-border" style="width:4%" span="2"> <!-- Ru 4 -->
        <col class="round-border" style="width:4%" span="2"> <!-- Ru 5 -->
        <col style="width:5%" span="2">  <!-- Gesamt Punkte/Tore -->
        <col style="width:10%">     <!-- Gesamt Total -->
    </colgroup>
    <thead>
        <tr>
            <th>Platz</th>
            <th>Mannschaften</th>
            <th colspan="2" class="round-border">Ru 1</th>
            <th colspan="2" class="round-border">Ru 2</th>
            <th colspan="2" class="round-border">Ru 3</th>
            <th colspan="2" class="round-border">Ru 4</th>
            <th colspan="2" class="round-border">Ru 5</th>
            <th colspan="2">Gesamt</th>
            <th>Gesamt Total</th>
        </tr>
        <tr>
            <th></th>
            <th></th>
            <th>P</th><th>T</th>
            <th>P</th><th>T</th>
            <th>P</th><th>T</th>
            <th>P</th><th>T</th>
            <th>P</th><th>T</th>
            <th>Ges P</th><th>Ges T</th>
            <th>Gesamt Total</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- SheetJS f√ºr XLSX Export -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

<script>
function loadTeamsFromLocalStorage() {
    const teams = JSON.parse(localStorage.getItem('wattTeams')) || [];
    const tbody = document.querySelector('#preliminary-round tbody');
    tbody.innerHTML = '';

    teams.forEach(team => {
        const row = tbody.insertRow();
        row.insertCell(0).textContent = '';
        row.insertCell(1).textContent = `${team.player1} / ${team.player2}`;

        for (let i = 0; i < 5; i++) {
            const points = team.rounds?.[i]?.points ?? '';
            const goals = team.rounds?.[i]?.goals ?? '';
            const roundClass = `round${i+1}`;
            row.insertCell(-1).innerHTML = `<input type="number" class="points ${roundClass}" data-round="${i}" value="${points}">`;
            row.insertCell(-1).innerHTML = `<input type="number" class="goals ${roundClass}" data-round="${i}" value="${goals}">`;
        }

        row.insertCell(-1).innerHTML = `<input type="number" class="total-points" readonly>`;
        row.insertCell(-1).innerHTML = `<input type="number" class="total-goals" readonly>`;
        row.insertCell(-1).innerHTML = `<input type="number" class="overall-total" readonly>`;
    });

    calculateTotals();
    sortTeams();
}

function saveToLocalStorage() {
    const rows = document.querySelectorAll('#preliminary-round tbody tr');
    const updatedTeams = [];
    const existingTeams = JSON.parse(localStorage.getItem('wattTeams')) || [];

    rows.forEach(row => {
        const name = row.cells[1].textContent;
        const [player1, player2] = name.split(' / ');
        const rounds = [];

        row.querySelectorAll('.points').forEach((input, roundIndex) => {
            const points = parseInt(input.value) || 0;
            const goals = parseInt(row.querySelector(`.goals[data-round="${roundIndex}"]`).value) || 0;
            rounds.push({ points, goals });
        });

        const existingTeam = existingTeams.find(t => t.player1 === player1 && t.player2 === player2);
        const paid = existingTeam ? existingTeam.paid : false;

        updatedTeams.push({ player1, player2, rounds, paid });
    });

    localStorage.setItem('wattTeams', JSON.stringify(updatedTeams));
}

function calculateTotals() {
    const rows = document.querySelectorAll('#preliminary-round tbody tr');

    rows.forEach(row => {
        let totalPoints = 0;
        let totalGoals = 0;

        row.querySelectorAll('.points').forEach(input => {
            totalPoints += parseInt(input.value) || 0;
        });
        row.querySelectorAll('.goals').forEach(input => {
            totalGoals += parseInt(input.value) || 0;
        });

        row.querySelector('.total-points').value = totalPoints;
        row.querySelector('.total-goals').value = totalGoals;
        row.querySelector('.overall-total').value = totalPoints * 100 + totalGoals;
    });

    saveToLocalStorage();
}

function sortTeams() {
    const tbody = document.querySelector('#preliminary-round tbody');
    const rows = Array.from(tbody.rows);

    rows.sort((a, b) => {
        const totalA = parseInt(a.querySelector('.overall-total').value) || 0;
        const totalB = parseInt(b.querySelector('.overall-total').value) || 0;
        return totalB - totalA;
    });

    rows.forEach((row, index) => {
        tbody.appendChild(row);
        row.cells[0].textContent = index + 1;

        let bgColor = "#ADD8E6";
        if (index === 0) bgColor = "#FFD700";
        else if (index === 1) bgColor = "#C0C0C0";
        else if (index === 2) bgColor = "#CD7F32";

        row.querySelectorAll("td").forEach(cell => {
            cell.style.backgroundColor = bgColor;
        });
    });
}

function filterTeams() {
    const searchValue = document.getElementById('searchTeam').value.toLowerCase();
    document.querySelectorAll('#preliminary-round tbody tr').forEach(row => {
        const teamName = row.cells[1].textContent.toLowerCase();
        row.style.display = teamName.includes(searchValue) ? '' : 'none';
    });
}

// ‚úÖ Export als XLSX
function exportToExcel() {
    const wb = XLSX.utils.book_new();
    const ws_data = [];
    const headers = [
        "Platz", "Mannschaften",
        "Ru1 P", "Ru1 T", "Ru2 P", "Ru2 T", "Ru3 P", "Ru3 T", "Ru4 P", "Ru4 T", "Ru5 P", "Ru5 T",
        "Ges P", "Ges T", "Gesamt Total"
    ];
    ws_data.push(headers);

    document.querySelectorAll('#preliminary-round tbody tr').forEach(row => {
        const rowData = [];
        rowData.push(row.cells[0].textContent); // Platz
        rowData.push(row.cells[1].textContent); // Mannschaft
        row.querySelectorAll('.points').forEach(input => rowData.push(input.value));
        row.querySelectorAll('.goals').forEach(input => rowData.push(input.value));
        rowData.push(row.querySelector('.total-points').value);
        rowData.push(row.querySelector('.total-goals').value);
        rowData.push(row.querySelector('.overall-total').value);
        ws_data.push(rowData);
    });

    const ws = XLSX.utils.aoa_to_sheet(ws_data);
    XLSX.utils.book_append_sheet(wb, ws, "Vorrunde");
    XLSX.writeFile(wb, "Vorrunde.xlsx");
}

document.addEventListener('input', calculateTotals);
document.addEventListener('DOMContentLoaded', loadTeamsFromLocalStorage);
</script>
<nav class="app-menu">
    <a href="index.html">üè†<br>Anmeldung</a>
    <a href="vorrunde.html">üìã<br>Vorrunde</a>
    <a href="auslosung1.html">üé≤<br>Auslosung 1</a>
    <a href="auslosung2.html">üé≤<br>Auslosung 2</a>
    <a href="auslosung3.html">üé≤<br>Auslosung 3</a>
    <a href="auslosung4.html">üé≤<br>Auslosung 4</a>
    <a href="auslosung5.html">üé≤<br>Auslosung 5</a>
    <a href="viertelfinale.html">üèÜ<br>Viertelfinale</a>
    <a href="halbfinale.html">ü•à<br>Halbfinale</a>
    <a href="finale.html">ü•á<br>Finale</a>
</nav>

</body>
</html>



